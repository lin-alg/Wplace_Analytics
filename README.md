# WPlace Analytics 使用说明

## 📖 简介

WPlace Analytics 是一个用于可视化和分析 WPlace 网站数据的网页工具。它提供了联盟/玩家排行榜查看、热力图可视化等功能，支持历史数据查询和本地文件上传两种数据源。

---
## ⚠ 免责声明
1. 爬取得到的数据仅供个人使用，请勿用于商业用途
2. 本网站不保证爬取到的数据100%真实，因网站限制仅能查询地区排行榜的前五十条，且排行榜有时效性

---

## 🚀 使用说明

### 1️⃣ 查询历史数据

**操作步骤**:
1. 在"查询历史数据"区域选择参数：
   - **Type (类型)**: 
     - `Alliances` - 联盟数据
     - `Players` - 玩家数据
   - **Range (范围)**:
     - `All-Time` - 历史总计
     - `Today` - 仅今日数据
   - **Date (日期)**: 选择要查询的日期

2. 点击 **"查询"** 按钮， 系统会自动查找对应的数据文件， 加载成功后会显示排行榜

---

### 2️⃣ 上传本地文件

**适用场景**: 查看本地生成的数据文件，或服务器上没有对应日期的数据

**操作方法**:

**方法一**: 点击上传
1. 点击"点击或拖拽上传数据文件"区域
2. 在弹出的文件选择对话框中选择 `.json` 文件
3. 文件会自动加载并显示排行榜

**方法二**: 拖拽上传
1. 直接将 `.json` 文件拖拽到上传区域
2. 释放鼠标后自动加载

**支持的文件格式**:
- 必须是 `.json` 格式
- 文件内容需符合爬虫生成的数据结构，可用本仓库release内提供的数据采集器进行采集。

---

### 3️⃣ 排行榜功能

加载数据后，会显示一个排行榜界面：

#### 列说明
| 列名 | 说明 |
|------|------|
| **Rank** | 排名 |
| **Name** | 联盟/玩家名称及 ID |
| **Pixels** | 总像素绘制数量 |
| **Action** | 查看热力图 |

---

### 4️⃣ 搜索功能

在排行榜显示后，可以使用搜索功能：

1. 在搜索框中输入：
   - **名称**: 支持模糊搜索（不区分大小写）
   - **ID**: 精准匹配

2. 点击 **"搜索"** 按钮或按 **Enter** 键展示搜索结果

3. 点击 **"重置"** 按钮可恢复显示前 100 名排行榜

**搜索示例**:
```
搜索 "Dragon" → 显示所有名称包含 "dragon" 的条目
搜索 "12345" → 精准匹配 ID 为 12345 的条目
```

---

### 5️⃣ 热力图可视化

对于有地理位置数据的联盟/玩家，可以查看热力图：

#### 查看热力图
1. 在排行榜中点击某行的 **"查看热力图"** 按钮
2. 进入全屏地图视图

#### 热力图界面
- **热力图层**: 显示像素密度分布
  - 🔵 蓝绿色：低密度区域
  - 🟡 黄色：中密度区域
  - 🔴 红色：高密度区域
  
- **信息卡片** (左上角):
  - 显示名称
  - 统计有绘制点的区域数（以4000*4000像素的范围为一个区域）
  - 显示总绘制像素数

- **交互点**: 可以点击热力图上的区域查看具体像素数

#### 地图操作
- **缩放**: 鼠标滚轮
- **平移**: 鼠标拖拽
- **右键菜单**: 右键点击地图可跳转到 WPlace 对应位置
- **返回**: 点击左上角 **"返回列表"** 按钮

---

### 6️⃣ 回到主页

在查看排行榜时，会显示一个 **"回到主页"** 按钮

**功能**:
- 清除当前数据
- 返回初始上传/查询界面
- 重置所有状态

**使用场景**:
- 查看完数据后想加载新的数据文件
- 切换查询不同日期/类型的数据

---

## 🌍 多语言支持

网站支持中英文双语切换（自动检测浏览器语言）：

| 中文 | English |
|------|---------|
| Wplace数据分析 | WPlace Analytics |
| 联盟/玩家排行榜与热力图可视化 | Leaderboard & Heatmap Visualization |
| 点击或拖拽上传数据文件 | Click or Drag Data File Here |
| 查询历史数据 | Query Historical Data |
| 查看热力图 | View Map |
| 返回列表 | Back to List |
| 回到主页 | Back to Home |

---

## 📊 数据文件说明

### 文件命名规范
```
wplace_{type}_{range}_{date}.json
```

**参数说明**:
- `{type}`: `alliances` 或 `players`
- `{range}`: `all-time` 或 `today`
- `{date}`: 日期格式 `YYYYMMDD`

**示例**:
```
wplace_alliances_all-time_20250127.json  ← 2025年1月27日的联盟历史总计数据
wplace_players_today_20250127.json       ← 2025年1月27日的玩家当日数据
```

### 数据结构
```json
{
  "12345": {
    "name": "Dragon Alliance",
    "totalPixelsPainted": 150000,
    "places": {
      "84840": 5000,
      "84841": 3200,
      "85352": 8900
    }
  },
  "67890": {
    "name": "Phoenix Guild",
    "totalPixelsPainted": 120000,
    "places": {
      "84840": 4500,
      "86000": 6700
    }
  }
}
```

**字段说明**:
- **ID** (外层键): 联盟/玩家的唯一标识符
- **name**: 名称
- **totalPixelsPainted**: 总像素绘制数
- **places**: 各区域的像素分布
  - 键: Region ID (区域编号)
  - 值: 该区域的像素数

---

## 🛠️ 数据采集工具

数据文件通过配套的 Python 爬虫工具生成：

### 爬虫功能
- ✅ 自动扫描指定 Region 范围
- ✅ 支持联盟/玩家两种模式
- ✅ 支持历史总计/今日两种时间范围
- ✅ 失败重扫机制（自动重试直到全部成功）
- ✅ 速率限制（避免服务器断开连接）
- ✅ 数据校验（生成哈希文件）

### 使用方法
![alt text](/images/image1.png)
1. 默认区块范围为84840-128447，即覆盖中国全境。接口格式为https://backend.wplace.live/leaderboard/region/players/{ID}/today，其中的ID即为区块ID
2. 中途可暂停，但不能关闭采集器，否则数据将丢失。按停止时会把当前抓取的部分数据保存
3. 扫描结束后会生成一个json文件和一个txt文件，如果要提交PR，则应打包成zip便于检验文件完整性
---

## 💡 使用技巧

### 1. 快速查看最新数据
```
1. 选择日期
2. 选择时间区间（All-time或today）
3. 选择联盟或玩家（alliances或Players）
4. 点击查询
```

### 2. 对比不同日期数据
```
1. 查看第一个日期的数据
2. 点击"回到主页"
3. 查看第二个日期的数据
4. 对比排名变化
```

### 3. 查找特定联盟/玩家
```
1. 加载数据后
2. 在搜索框输入名称或 ID
3. 按 Enter 键快速搜索
```

### 4. 分析地理分布
```
1. 在排行榜点击"查看热力图"
2. 观察颜色分布（蓝→黄→红）
3. 点击热点区域查看具体数据
4. 右键点击可跳转到 WPlace 官网
```
---

## 🌐 网站部署

### 文件结构
```
website/
├── index.html         # 主页面文件
├── range.png          # 扫描范围示意图
└── /data              # 数据文件夹
```

### 部署步骤
1. 将 `index.html` 放置在 Web 服务器目录下
2. 将数据文件（`.json`）放在同一目录的data文件夹下
3. 同目录下放置 `range.png` 图片用于显示扫描范围
4. 通过浏览器访问即可使用

> **提示**: 也可以直接在本地打开 `index.html`，但查询历史数据功能需要 HTTP 服务器支持。
---

## ⚠️ 注意事项

### 浏览器兼容性
- ✅ 推荐使用现代浏览器（Chrome、Firefox、Safari、Edge）
- ✅ 需要支持 ES6+ JavaScript
- ✅ 需要支持 Leaflet 地图库

### 性能建议
- 数据量较大时（>10000 条），搜索可能有轻微延迟
- 热力图加载时间取决于区域数量
- 建议在较快的网络环境下查询历史数据

### 数据隐私
- 所有数据处理在浏览器本地完成
- 上传的json文件不会发送到任何服务器
- 查询历史数据仅访问部署的静态文件

---

## 🐛 常见问题

### Q1: 点击"查询"后提示文件未找到？
**A**: 可能是如下原因：
1. 查询区间有误
2. 该查询区间未被爬取收录

### Q2: 上传 JSON 文件后显示"文件格式错误"？
**A**: 确认：
1. 文件是否为有效的 JSON 格式
2. 文件编码是否为 UTF-8
3. 数据结构是否符合要求

### Q3: 热力图显示空白？
**A**: 可能原因：
1. 该联盟/玩家没有地理位置数据（places 为空）
3. 浏览器不支持 Leaflet

### Q4: 搜索没有结果？
**A**: 检查：
1. 输入是否有拼写错误
2. 该名称/ID 是否存在于当前数据中
3. 点击"重置"后重试

### Q5: "回到主页"按钮点击后数据丢失？
**A**: 这是正常行为。"回到主页"会清除所有当前查询的数据，返回初始状态。

---

## 📞 技术支持

如有问题或建议，请联系开发者或在项目仓库提交 Issue。

---

## 📄 许可证

GNU General Public License v3.0

---